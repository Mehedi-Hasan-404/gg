# .github/workflows/update_cookies.yml
name: Hourly ToffeeLive M3U Updater

on:
  schedule:
    - cron: '*1 * * * *' 
  workflow_dispatch:

jobs:
  refresh_and_commit:
    runs-on: ubuntu-latest
    
    steps:
      - name: â¬‡ï¸ Checkout repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0 
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ğŸ Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: ğŸ“¦ Install Python dependencies (Playwright)
        # Playwright and its browser drivers are needed for simulation
        run: |
          pip install playwright
          playwright install chromium # Install the necessary browser driver

      - name: ğŸ”„ Run Automation Script and Generate Playlist
        # PROXY_URL is passed as an environment variable from GitHub Secrets
        run: python automation.py
        env:
          # You must set up a secret named PROXY_URL with your proxy address
          PROXY_URL: ${{ secrets.PROXY_URL }} 
        
      - name: ğŸ“¤ Commit updated M3U playlist to GitHub
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          file_pattern: playlist.m3u
          commit_message: "ğŸ¤– AUTOMATION: Refreshed M3U playlist with new cookies"
          commit_author: GitHub Actions <actions@github.com>
