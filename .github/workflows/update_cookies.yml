#.github/workflows/update_cookies.yml
name: Hourly ToffeeLive M3U Updater

on:
  # Schedule to run every hour at 30 minutes past the hour (Adjust if needed)
  schedule:
    - cron: '*/1 * * * *' 
  # Allows manual triggering for testing
  workflow_dispatch:

jobs:
  refresh_and_commit:
    runs-on: ubuntu-latest
    
    steps:
      - name: â¬‡ï¸ Checkout repository
        uses: actions/checkout@v4
        with:
          # Required to allow the workflow to commit changes back
          fetch-depth: 0 
          token: ${{ secrets.GITHUB_TOKEN }}

      - name: ğŸ Set up Python
        uses: actions/setup-python@v5
        with:
          python-version: '3.x'

      - name: ğŸ“¦ Install dependencies (requests)
        # The Python script needs the 'requests' library
        run: pip install requests

      - name: ğŸ”„ Run Automation Script and Generate Playlist
        # Executes automation.py, which fetches the cookie and writes playlist.m3u
        run: python automation.py
        
      - name: ğŸ“¤ Commit updated M3U playlist to GitHub
        uses: stefanzweifel/git-auto-commit-action@v5
        with:
          # Only commit the new playlist file
          file_pattern: playlist.m3u
          commit_message: "ğŸ¤– AUTOMATION: Refreshed M3U playlist with new cookies"
          commit_author: GitHub Actions <actions@github.com>

